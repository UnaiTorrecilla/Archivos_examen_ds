load('muestra40.RData')
View(muestra40)
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
library(dplyr)
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
grepl('[:alpha:]{8}', muestra40$nif)
grepl('[:digit:]{8}', muestra40$nif)
grepl('[:digit:]{8}[:alpha:]?', muestra40$nif)
formato_correcto <- grepl('[:digit:]{8}[:alpha:]?', muestra40$nif)
which(formato_correcto)
which(formato_correcto == T)
formato_correcto <- grepl('[:digit:]{7,}[:alpha:]?', muestra40$nif)
formato_correcto
formato_correcto <- grepl('[:alnum:]{7,}[:alpha:]?', muestra40$nif)
formato_correcto
formato_correcto <- grepl('[[:digit:]]{7,}[[:alpha:]]?', muestra40$nif)
formato_correcto
formato_correcto <- grepl('[[:digit:]]{8,}[[:alpha:]]?', muestra40$nif)
formato_correcto
formato_correcto1 <- which(formato_correcto == T)
filas_buenas <- muestra40[formato_correcto1,]
View(filas_buenas)
formato_correcto <- grepl('[[:digit:]]{8}[[:alpha:]]?', muestra40$nif)
formato_correcto1 <- which(formato_correcto == T)
filas_buenas <- muestra40[formato_correcto1,]#En este fichero tenemos los NIF que tienen primero
formato_nacional <- grepl('[[:digit:]]{8}[[:alpha:]]{1}', muestra40$nif)
formato_nacional1 <- which(formato_nacional == T)
filas_formato_nacional <- muestra40[formato_nacional1, ]
alguna_limpieza <- grepl('[[:digit:]]{0,7}')
alguna_limpieza <- grepl('[[:digit:]]{0,7}', muestra40$nif)
alguna_limpieza1 <- which(alguna_limpieza == T)
mdatos1 <- muestra40[alguna_limpieza1 == T, ]
View(mdatos1)
alguna_limpieza <- grepl('[[:digit:]]{0,7}[[:alpha:]]*', muestra40$nif)
alguna_limpieza1 <- which(alguna_limpieza == T)
mdatos1 <- muestra40[alguna_limpieza1 == T, ]
alguna_limpieza1
mdatos1 <- muestra40[alguna_limpieza1 == T, ]
load('muestra40.RData')
library(dplyr)
load('muestra40.RData')
library(dplyr)
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
alguna_limpieza <- grepl('[[:digit:]]{0,7}[[:alpha:]]*', muestra40$nif)
alguna_limpieza1 <- which(alguna_limpieza == T)
alguna_limpieza1
mdatos1 <- muestra40[alguna_limpieza1 == T, ]
mdatos1 <- muestra40[alguna_limpieza1, ]
alguna_limpieza <- grepl('[[:digit:]]{0,7}', muestra40$nif)
alguna_limpieza1 <- which(alguna_limpieza == T)
alguna_limpieza1
mdatos1 <- muestra40[alguna_limpieza1, ]
alguna_limpieza <- grepl('[[:digit:]]{1}', muestra40$nif)
alguna_limpieza1 <- which(alguna_limpieza == T)
alguna_limpieza1
mdatos1 <- muestra40[alguna_limpieza1, ]
alguna_limpieza <- grepl('[[:digit:]]?', muestra40$nif)
alguna_limpieza1 <- which(alguna_limpieza == T)
alguna_limpieza1
mdatos1 <- muestra40[alguna_limpieza1, ]
str(muestra40)
unique(muestra40$genero)
#Cambio a NA todos los géneros extraños
muestra40[muestra40$genero %in% c('', 'X', 'E')] <- NA
#Cambio a NA todos los géneros extraños
muestra40[muestra40$genero %in% c('', 'X', 'E'),] <- NA
unique(muestra40$genero)
load('muestra40.RData')
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
#Cambio a NA todos los géneros extraños
muestra40[muestra40$genero %in% c('', 'X', 'E'), 3] <- NA
library(stringr)
muestra40$nombre <- toupper(muestra40$nombre)
n_distinct(muestra40$nombre)
frecuencias_nombres <- muestra40 %>%
group_by(nombre, genero) %>%
summarize(frecuencia = n())
View(frecuencias_nombres)
n_distinct(muestra40$nombre)
prueba <- muestra40 %>%
left_join(frecuencias_nombres, by = 'nombre')
View(prueba)
frecuencias_nombres <- muestra40 %>%
group_by(nombre, genero) %>%
summarize(frecuencia_M = count(.$genero == 'M'))
frecuencias_nombres <- muestra40 %>%
group_by(nombre, genero) %>%
summarize(frecuencia_M = count(.$genero == 'M',))
frecuencias_nombres <- muestra40 %>%
group_by(nombre, genero) %>%
summarize(frecuencia_M = sum(.$genero == 'M',))
frecuencias_nombres <- muestra40 %>%
group_by(nombre, genero) %>%
summarize(frecuencia_M = sum(.[.$genero == 'M',]))
frecuencias_nombres <- muestra40 %>%
group_by(nombre, genero) %>%
summarize(frecuencia_M = count(.[.$genero == 'M',]))
load('muestra40.RData')
library(dplyr)
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
muestra40$nombre <- toupper(muestra40$nombre)
prueba1<- muestra40 %>%
group_by(nombre, genero) %>%
summarise(n=n())
View(prueba1)
load('muestra40.RData')
library(dplyr)
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
muestra40$nombre <- toupper(muestra40$nombre)
prueba1<- muestra40 %>%
group_by(nombre, genero) %>%
summarise(n=n())
prueba2<- prueba1 %>%
group_by(nombre)
View(prueba2)
View(muestra40)
for(i in 1:dim(muestra40)[1]){
for(j in 1:dim(prueba2)[1]){
if(muestra40[i,2]==prueba2[i,1]){
muestra40[i,4]<- prueba2[i,2]
}
}
}
datos_chicos <- muestra40 %>%
split(.$genero)
View(datos_chicos)
n_distinct(muestra40$genero)
unique(muestra40$genero)
muestra40[muestra40$genero %in% c('', 'X', 'E'),3] <- NA
datos_genero <- muestra40 %>%
split(.$genero)
View(datos_genero)
load('muestra40.RData')
library(dplyr)
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
# Analizo el NIF ----------------------------------------------------------
formato_correcto <- grepl('[[:digit:]]{8}[[:alpha:]]{1}', muestra40$nif)
formato_correcto
formato_correcto1 <- which(formato_correcto == T)
df_nice <- muestra40[formato_correcto1, ]
datos_chicos <- datos_genero[[1]]
datos_chicas <- datos_genero[[2]]
View(datos_chicos)
View(datos_chicas)
frecuencia_chicos <- datos_chicos %>%
group_by(nombre) %>%
tally()
View(frecuencia_chicos)
View(df_nice)
frecuencia_chicas <- datos_chicas %>%
group_by(nombre) %>%
tally()
View(frecuencia_chicas)
frecuencia_chicos <- frecuencia_chicos %>%
rename('n_M' = 'n')
load('muestra40.RData')
library(dplyr)
muestra40 <- muestra40 %>%
rename('nif' = 'var1',
'nombre' = 'var2',
'genero' = 'var3')
# Analizo el NIF ----------------------------------------------------------
formato_correcto <- grepl('[[:digit:]]{8}[[:alpha:]]{1}', muestra40$nif)
formato_correcto
formato_correcto1 <- which(formato_correcto == T)
df_nice <- muestra40[formato_correcto1, ]
muestra40$nombre <- toupper(muestra40$nombre)
muestra40[muestra40$genero %in% c('', 'X', 'E'),3] <- NA
unique(muestra40$genero)
datos_genero <- muestra40 %>%
split(.$genero)
View(datos_genero)
datos_chicas <- datos_genero[[1]]
datos_chicos <- datos_genero[[2]]
frecuencia_chicos <- datos_chicos %>%
group_by(nombre) %>%
tally()
frecuencia_chicos <- frecuencia_chicos %>%
rename('n_M' = 'n')
frecuencia_chicas <- datos_chicas %>%
group_by(nombre) %>%
tally()
frecuencia_chicas <- frecuencia_chicas %>%
rename('n_V' = 'n')
View(frecuencia_chicas)
View(frecuencia_chicos)
frecuencias_totales <- frecuencias_chicos %>%
full_join(frecuencias_chicos, by = 'nombre')
frecuencias_totales <- frecuencia_chicos %>%
full_join(frecuencia_chicos, by = 'nombre')
View(frecuencias_totales)
frecuencias_totales <- frecuencia_chicos %>%
full_join(frecuencia_chicas, by = 'nombre')
View(frecuencias_totales)
frecuencias_totales <- frecuencia_chicos %>%
right_join(frecuencia_chicas, by = 'nombre')
View(frecuencias_totales)
View(muestra40)
muestra40$genero_imputado[frecuencias_totales$n_M>frecuencias_totales$n_V] <- 'M'
frecuencias_totales[is.na(frecuencias_totales)] <- 0
muestra40$genero_imputado[frecuencias_totales$n_M>frecuencias_totales$n_V] <- 'M'
tabla_final <- muestra40 %>%
left_join(frecuencias_totales, by = 'nombre')
View(tabla_final)
tabla_final$genero_imputado[tabla_final$n_M>tabla_final$n_V] <- 'M'
tabla_final$genero_imputado[tabla_final$n_V>tabla_final$n_M] <- 'V'
tabla_final <- tabla_final[,-c(4,5)]
tabla_final <- tabla_final[-is.na(tabla_final$genero_imputado),]
tabla_final <- tabla_final[!is.na(tabla_final$genero_imputado),]
any(is.na(tabla_final$genero_imputado))
